/*
 * Copyright 2000-2013 JetBrains s.r.o.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

package matt_richardson.teamCity.buildTriggers.octopusDeploy;

import org.jetbrains.annotations.Nullable;
import org.testng.Assert;
import org.testng.annotations.Test;

import java.io.Closeable;
import java.io.IOException;
import java.net.URI;
import java.security.KeyManagementException;
import java.security.KeyStoreException;
import java.security.NoSuchAlgorithmException;
import java.text.SimpleDateFormat;
import java.util.Calendar;
import java.util.GregorianCalendar;


@Test
public class OctopusDeploymentsProviderTest {
  final String octopusUrl = "http://baseUrl";
  final String octopusApiKey = "api-key";
  final String octopusProject = "TestProject";

  public void testGetDeploymentsFromEmptyStart() throws Exception {
    HttpContentProvider contentProvider = new FakeContentProvider();
    OctopusDeploymentsProvider deploymentsProvider = new OctopusDeploymentsProvider(contentProvider);
    Deployments oldDeployments = new Deployments();
    Deployments newDeployments = deploymentsProvider.getDeployments(octopusUrl, octopusApiKey, octopusProject, oldDeployments);
    Assert.assertEquals(newDeployments.length(), 1);
    Deployment deployment = newDeployments.getDeploymentForEnvironment("Environments-1");
    Assert.assertNotNull(deployment);
    Assert.assertEquals(deployment.environmentId, "Environments-1");

    SimpleDateFormat formatter = new SimpleDateFormat("yyyy-MM-dd'T'HH:mm:ss");

    //2015-12-08T08:09:39.624+00:00
    Assert.assertEquals(formatter.format(deployment.latestDeployment),
                        formatter.format(new GregorianCalendar(2015, Calendar.DECEMBER, 8, 8, 9, 39).getTime()),
                        "Latest deployment is not as expected");
    //2015-11-12T09:22:00.865+00:00
    Assert.assertEquals(formatter.format(deployment.latestSuccessfulDeployment),
                        formatter.format(new GregorianCalendar(2015, Calendar.NOVEMBER, 12, 9, 22, 00).getTime()),
                        "Latest successful deployment is not as expected");
  }

  public void testGetDeploymentsWhenUpToDate() throws Exception {
    HttpContentProvider contentProvider = new FakeContentProvider();
    OctopusDeploymentsProvider deploymentsProvider = new OctopusDeploymentsProvider(contentProvider);
    Deployments oldDeployments = new Deployments();
    Deployments newDeployments = deploymentsProvider.getDeployments(octopusUrl, octopusApiKey, octopusProject, oldDeployments);
    Assert.assertEquals(newDeployments.length(), 1);
    Deployment deployment = newDeployments.getDeploymentForEnvironment("Environments-1");
    Assert.assertNotNull(deployment);
    Assert.assertEquals(deployment.toString(), "Environments-1;2015-12-08T08:09:39.624Z;2015-11-12T09:22:00.865Z");
  }

  public void testGetDeploymentsWhenNoSuccessfulDeploymentsHaveOccurred() throws Exception {
    HttpContentProvider contentProvider = new FakeContentProviderWithNoSuccessfulDeployments();
    OctopusDeploymentsProvider deploymentsProvider = new OctopusDeploymentsProvider(contentProvider);
    Deployments oldDeployments = new Deployments();
    Deployments newDeployments = deploymentsProvider.getDeployments(octopusUrl, octopusApiKey, octopusProject, oldDeployments);
    Assert.assertEquals(newDeployments.length(), 1);
    Deployment deployment = newDeployments.getDeploymentForEnvironment("Environments-1");
    Assert.assertNotNull(deployment);
    Assert.assertEquals(deployment.toString(), "Environments-1;2015-12-08T08:09:39.624Z;1970-01-01T01:00:00.000+01:00");
  }

  public void testGetDeploymentsWhenNoSuccessfulDeploymentsOnFirstPageOfResults() throws Exception {
    HttpContentProvider contentProvider = new FakeContentProviderWithTheFirstSuccessfulDeploymentOnTheSecondPage();
    OctopusDeploymentsProvider deploymentsProvider = new OctopusDeploymentsProvider(contentProvider);
    Deployments oldDeployments = new Deployments();
    Deployments newDeployments = deploymentsProvider.getDeployments(octopusUrl, octopusApiKey, octopusProject, oldDeployments);
    Assert.assertEquals(newDeployments.length(), 1);
    Deployment deployment = newDeployments.getDeploymentForEnvironment("Environments-1");
    Assert.assertNotNull(deployment);
    Assert.assertEquals(deployment.toString(), "Environments-1;2015-12-08T08:09:39.624Z;2015-11-12T09:22:00.865Z");
  }

  public void testGetDeploymentsWhenMultipleEnvironments() throws Exception {
    HttpContentProvider contentProvider = new FakeContentProviderWithMultipleEnvironments();
    OctopusDeploymentsProvider deploymentsProvider = new OctopusDeploymentsProvider(contentProvider);
    Deployments oldDeployments = new Deployments();
    Deployments newDeployments = deploymentsProvider.getDeployments(octopusUrl, octopusApiKey, octopusProject, oldDeployments);
    Assert.assertEquals(newDeployments.length(), 2);
    Deployment deployment = newDeployments.getDeploymentForEnvironment("Environments-1");
    Assert.assertNotNull(deployment);
    Assert.assertEquals(deployment.toString(), "Environments-1;2015-12-08T08:09:39.624Z;2015-11-12T09:22:00.865Z");
    deployment = newDeployments.getDeploymentForEnvironment("Environments-2");
    Assert.assertNotNull(deployment);
    Assert.assertEquals(deployment.toString(), "Environments-2;2015-11-12T09:58:33.113Z;2015-11-12T09:58:33.113Z");
  }

  private class FakeContentProviderWithNoSuccessfulDeployments implements HttpContentProvider {
    public void close(@Nullable Closeable closeable) {
      //no-op
    }

    public String getContent(URI uri) throws IOException {
      String s = uri.toString();
      if (s.equals(octopusUrl + "/api")) {
        return "{  \"Application\": \"Octopus Deploy\",  \"Version\": \"3.2.1\",  \"ApiVersion\": \"3.0.0\",  \"FormsLoginEnabled\": true,  \"Links\": {    \"Self\": \"/api\",    \"Accounts\": \"/api/accounts{/id}{?skip}\",    \"ActionTemplates\": \"/api/actiontemplates{/id}{?skip}\",    \"Alerts\": \"/api/alerts{/id}{?skip}\",    \"Artifacts\": \"/api/artifacts{/id}{?skip,regarding}\",    \"Channels\": \"/api/channels{/id}\",    \"Certificates\": \"/api/certificates{/id}{?skip}\",    \"CurrentUser\": \"/api/users/me\",    \"CurrentLicense\": \"/api/licenses/licenses-current\",    \"Dashboard\": \"/api/dashboard\",    \"DashboardConfiguration\": \"/api/dashboardconfiguration\",    \"DashboardDynamic\": \"/api/dashboard/dynamic{?projects,environments,includePrevious}\",    \"DeploymentProcesses\": \"/api/deploymentprocesses{/id}\",    \"Deployments\": \"/api/deployments{/id}{?skip,take,projects,environments,taskState}\",    \"DiscoverMachine\": \"/api/machines/discover{?host,port,type}\",    \"Environments\": \"/api/environments{/id}{?skip}\",    \"EnvironmentSortOrder\": \"/api/environments/sortorder\",    \"Events\": \"/api/events{/id}{?skip,regarding,modifier,user,from,to}\",    \"ExternalSecurityGroups\": \"/api/externalsecuritygroups{/id}{?name}\",    \"Feeds\": \"/api/feeds{/id}{?skip}\",    \"Interruptions\": \"/api/interruptions{/id}{?skip,regarding,pendingOnly}\",    \"Invitations\": \"/api/users/invitations\",    \"LibraryVariables\": \"/api/libraryvariablesets{/id}{?skip,contentType}\",    \"Lifecycles\": \"/api/lifecycles{/id}{?skip}\",    \"MachineRoles\": \"/api/machineroles/all\",    \"Machines\": \"/api/machines{/id}{?skip,thumbprint}\",    \"MaintenanceConfiguration\": \"/api/maintenanceconfiguration\",    \"OctopusServerNodes\": \"/api/octopusservernodes{/id}\",    \"Packages\": \"/api/packages{/id}{?nuGetPackageId,filter,latest,skip,take,includeNotes}\",    \"PackagesBulk\": \"/api/packages/bulk{?ids}\",    \"PackageUpload\": \"/api/packages/raw{?replace}\",    \"ProjectGroups\": \"/api/projectgroups{/id}{?skip}\",    \"Projects\": \"/api/projects{/id}{?skip,clone}\",    \"ProjectPulse\": \"/api/projects/pulse{?projectIds}\",    \"Register\": \"/api/users/register\",    \"Releases\": \"/api/releases{/id}{?skip,ignoreChannelRules}\",    \"ServerStatus\": \"/api/serverstatus\",    \"SignIn\": \"/api/users/login{?returnUrl}\",    \"SignOut\": \"/api/users/logout\",    \"RetentionPolicies\": \"/api/retentionpolicies{/id}{?skip}\",    \"SmtpConfiguration\": \"/api/smtpconfiguration\",    \"Tasks\": \"/api/tasks{/id}{?skip,active,environment,project,name,node,running}\",    \"Teams\": \"/api/teams{/id}{?skip}\",    \"UserRoles\": \"/api/userroles{/id}{?skip}\",    \"Users\": \"/api/users{/id}{?skip}\",    \"PermissionDescriptions\": \"/api/permissions/all\",    \"Variables\": \"/api/variables{/id}\",    \"VariableNames\": \"/api/variables/names{?project}\",    \"VersionRuleTest\": \"/api/channels/rule-test{?version,versionRange,preReleaseTag}\",    \"Reporting/DeploymentsCountedByWeek\": \"/api/reporting/deployments-counted-by-week{?projectIds}\",    \"RepositoryConfiguration\": \"/api/repository/configuration\",    \"Web\": \"/app\"  }}";
      }
      if (s.equals(octopusUrl + "/api/projects")) {
        return "{\"ItemType\": \"Project\",\"IsStale\": false,\"TotalResults\": 1,\"ItemsPerPage\": 30,\"Items\": [{\"Id\": \"Projects-1\",\"VariableSetId\": \"variableset-Projects-1\",\"DeploymentProcessId\": \"deploymentprocess-Projects-1\",\"IncludedLibraryVariableSetIds\": [],\"DefaultToSkipIfAlreadyInstalled\": false,\"VersioningStrategy\": {\"DonorPackageStepId\": null,\"Template\": \"#{Octopus.Version.LastMajor}.#{Octopus.Version.LastMinor}.#{Octopus.Version.NextPatch}\"},\"ReleaseCreationStrategy\": {\"ReleaseCreationPackageStepId\": null,\"ChannelId\": null},\"Name\": \"TestProject\",\"Slug\": \"testproject\",\"Description\": \"\",\"IsDisabled\": false,\"ProjectGroupId\": \"ProjectGroups-1\",\"LifecycleId\": \"Lifecycles-1\",\"AutoCreateRelease\": false,\"Links\": {\"Self\": \"/api/projects/Projects-1\",\"Releases\": \"/api/projects/Projects-1/releases{/version}{?skip}\",\"Channels\": \"/api/projects/Projects-1/channels\",\"OrderChannels\": \"/api/projects/Projects-1/channels/order\",\"Variables\": \"/api/variables/variableset-Projects-1\",\"Progression\": \"/api/progression/Projects-1\",\"DeploymentProcess\": \"/api/deploymentprocesses/deploymentprocess-Projects-1\",\"Web\": \"/app#/projects/Projects-1\",\"Logo\": \"/api/projects/Projects-1/logo\"}}],\"Links\": {\"Self\": \"/api/projects\",\"Template\": \"/api/projects{?skip}\",\"Page.Current\": \"/api/projects?skip=0\",\"Page.0\": \"/api/projects?skip=0\"}}";
      }
      if (s.equals(octopusUrl + "/api/deployments?Projects=Projects-1")) {
        return "{\"ItemType\":\"Deployment\",\"IsStale\":false,\"TotalResults\":2,\"ItemsPerPage\":30,\"Items\":[{\"Id\":\"Deployments-41\",\"ReleaseId\":\"Releases-22\",\"EnvironmentId\":\"Environments-1\",\"ForcePackageDownload\":false,\"ForcePackageRedeployment\":false,\"SkipActions\":[],\"SpecificMachineIds\":[],\"DeploymentProcessId\":\"deploymentprocess-Projects-1-s-4-NH2MN\",\"ManifestVariableSetId\":\"variableset-Deployments-41\",\"TaskId\":\"ServerTasks-76\",\"ProjectId\":\"Projects-1\",\"UseGuidedFailure\":true,\"Comments\":null,\"FormValues\":{},\"QueueTime\":null,\"Name\":\"Deploy to local (#2)\",\"Created\":\"2015-12-08T08:09:39.624+00:00\",\"Links\":{\"Self\":\"/api/deployments/Deployments-41\",\"Release\":\"/api/releases/Releases-22\",\"Environment\":\"/api/environments/Environments-1\",\"Project\":\"/api/projects/Projects-1\",\"Task\":\"/api/tasks/ServerTasks-76\",\"Web\":\"/app#/deployments/Deployments-41\",\"Artifacts\":\"/api/artifacts?regarding=Deployments-41\",\"Variables\":\"/api/variables/variableset-Deployments-41\",\"Interruptions\":\"/api/interruptions?regarding=Deployments-41\"}},{\"Id\":\"Deployments-22\",\"ReleaseId\":\"Releases-22\",\"EnvironmentId\":\"Environments-1\",\"ForcePackageDownload\":false,\"ForcePackageRedeployment\":false,\"SkipActions\":[],\"SpecificMachineIds\":[],\"DeploymentProcessId\":\"deploymentprocess-Projects-1-s-4-NH2MN\",\"ManifestVariableSetId\":\"variableset-Deployments-22\",\"TaskId\":\"ServerTasks-43\",\"ProjectId\":\"Projects-1\",\"UseGuidedFailure\":true,\"Comments\":null,\"FormValues\":{},\"QueueTime\":null,\"Name\":\"Deploy to local\",\"Created\":\"2015-11-12T09:58:33.113+00:00\",\"Links\":{\"Self\":\"/api/deployments/Deployments-22\",\"Release\":\"/api/releases/Releases-22\",\"Environment\":\"/api/environments/Environments-1\",\"Project\":\"/api/projects/Projects-1\",\"Task\":\"/api/tasks/ServerTasks-43\",\"Web\":\"/app#/deployments/Deployments-22\",\"Artifacts\":\"/api/artifacts?regarding=Deployments-22\",\"Variables\":\"/api/variables/variableset-Deployments-22\",\"Interruptions\":\"/api/interruptions?regarding=Deployments-22\"}}],\"Links\":{\"Self\":\"/api/deployments?projects=Projects-1\",\"Template\":\"/api/deployments{?skip,take,projects,environments,taskState}\",\"Page.Current\":\"/api/deployments?skip=0&projects=Projects-1\",\"Page.0\":\"/api/deployments?skip=0&projects=Projects-1\"}}";
      }
      if (s.equals(octopusUrl + "/api/tasks/ServerTasks-76")) {
        return "{\"Id\": \"ServerTasks-76\",\"Name\": \"Deploy\",\"Description\": \"Deploy TestProject release 0.0.5 to local\",\"Arguments\": {\"DeploymentId\": \"Deployments-41\"},\"State\": \"Failed\",\"Completed\": \"09 December 2015 17:31\",\"QueueTime\": \"2015-12-08T08:09:39.546+00:00\",\"StartTime\": \"2015-12-08T08:09:40.046+00:00\",\"LastUpdatedTime\": \"2015-12-09T17:31:36.402+00:00\",\"CompletedTime\": \"2015-12-09T17:31:36.402+00:00\",\"ServerNode\": \"DESKTOP-4VQNCHP\",\"Duration\": \"1 day\",\"ErrorMessage\": \"The deployment failed because one or more steps failed. Please see the deployment log for details.\",\"HasBeenPickedUpByProcessor\": true,\"IsCompleted\": true,\"FinishedSuccessfully\": false,\"HasPendingInterruptions\": true,\"CanRerun\": false,\"HasWarningsOrErrors\": true,\"Links\": {\"Self\": \"/api/tasks/ServerTasks-76\",\"Web\": \"/app#/tasks/ServerTasks-76\",\"Raw\": \"/api/tasks/ServerTasks-76/raw\",\"Rerun\": \"/api/tasks/rerun/ServerTasks-76\",\"Cancel\": \"/api/tasks/ServerTasks-76/cancel\",\"QueuedBehind\": \"/api/tasks/ServerTasks-76/queued-behind\",\"Details\": \"/api/tasks/ServerTasks-76/details{?verbose,tail}\",\"Artifacts\": \"/api/artifacts?regarding=ServerTasks-76\",\"Interruptions\": \"/api/tasks\"}}";
      }
      if (s.equals(octopusUrl + "/api/tasks/ServerTasks-43")) {
        return "{\"Id\": \"ServerTasks-43\",\"Name\": \"Deploy\",\"Description\": \"Deploy TestProject release 0.0.5 to local\",\"Arguments\": {\"DeploymentId\": \"Deployments-22\"},\"State\": \"Failed\",\"Completed\": \"12 November 2015 09:59\",\"QueueTime\": \"2015-11-12T09:58:33.099+00:00\",\"StartTime\": \"2015-11-12T09:58:33.899+00:00\",\"LastUpdatedTime\": \"2015-11-12T09:59:07.071+00:00\",\"CompletedTime\": \"2015-11-12T09:59:07.071+00:00\",\"ServerNode\": \"DESKTOP-4VQNCHP\",\"Duration\": \"33 seconds\",\"ErrorMessage\": \"The deployment failed because one or more steps failed. Please see the deployment log for details.\",\"HasBeenPickedUpByProcessor\": true,\"IsCompleted\": true,\"FinishedSuccessfully\": false,\"HasPendingInterruptions\": true,\"CanRerun\": false,\"HasWarningsOrErrors\": true,\"Links\": {\"Self\": \"/api/tasks/ServerTasks-43\",\"Web\": \"/app#/tasks/ServerTasks-43\",\"Raw\": \"/api/tasks/ServerTasks-43/raw\",\"Rerun\": \"/api/tasks/rerun/ServerTasks-43\",\"Cancel\": \"/api/tasks/ServerTasks-43/cancel\",\"QueuedBehind\": \"/api/tasks/ServerTasks-43/queued-behind\",\"Details\": \"/api/tasks/ServerTasks-43/details{?verbose,tail}\",\"Artifacts\": \"/api/artifacts?regarding=ServerTasks-43\",\"Interruptions\": \"/api/tasks\"}}";
      }
      return null;
    }

    public void init(URI uri, String octopusApiKey, Integer connectionTimeout) throws KeyStoreException, NoSuchAlgorithmException, KeyManagementException {
      //no-op
    }
  }

  private class FakeContentProviderWithTheFirstSuccessfulDeploymentOnTheSecondPage implements HttpContentProvider {
    public void close(@Nullable Closeable closeable) {
      //no-op
    }

    public String getContent(URI uri) throws IOException {
      String s = uri.toString();
      if (s.equals(octopusUrl + "/api")) {
        return "{  \"Application\": \"Octopus Deploy\",  \"Version\": \"3.2.1\",  \"ApiVersion\": \"3.0.0\",  \"FormsLoginEnabled\": true,  \"Links\": {    \"Self\": \"/api\",    \"Accounts\": \"/api/accounts{/id}{?skip}\",    \"ActionTemplates\": \"/api/actiontemplates{/id}{?skip}\",    \"Alerts\": \"/api/alerts{/id}{?skip}\",    \"Artifacts\": \"/api/artifacts{/id}{?skip,regarding}\",    \"Channels\": \"/api/channels{/id}\",    \"Certificates\": \"/api/certificates{/id}{?skip}\",    \"CurrentUser\": \"/api/users/me\",    \"CurrentLicense\": \"/api/licenses/licenses-current\",    \"Dashboard\": \"/api/dashboard\",    \"DashboardConfiguration\": \"/api/dashboardconfiguration\",    \"DashboardDynamic\": \"/api/dashboard/dynamic{?projects,environments,includePrevious}\",    \"DeploymentProcesses\": \"/api/deploymentprocesses{/id}\",    \"Deployments\": \"/api/deployments{/id}{?skip,take,projects,environments,taskState}\",    \"DiscoverMachine\": \"/api/machines/discover{?host,port,type}\",    \"Environments\": \"/api/environments{/id}{?skip}\",    \"EnvironmentSortOrder\": \"/api/environments/sortorder\",    \"Events\": \"/api/events{/id}{?skip,regarding,modifier,user,from,to}\",    \"ExternalSecurityGroups\": \"/api/externalsecuritygroups{/id}{?name}\",    \"Feeds\": \"/api/feeds{/id}{?skip}\",    \"Interruptions\": \"/api/interruptions{/id}{?skip,regarding,pendingOnly}\",    \"Invitations\": \"/api/users/invitations\",    \"LibraryVariables\": \"/api/libraryvariablesets{/id}{?skip,contentType}\",    \"Lifecycles\": \"/api/lifecycles{/id}{?skip}\",    \"MachineRoles\": \"/api/machineroles/all\",    \"Machines\": \"/api/machines{/id}{?skip,thumbprint}\",    \"MaintenanceConfiguration\": \"/api/maintenanceconfiguration\",    \"OctopusServerNodes\": \"/api/octopusservernodes{/id}\",    \"Packages\": \"/api/packages{/id}{?nuGetPackageId,filter,latest,skip,take,includeNotes}\",    \"PackagesBulk\": \"/api/packages/bulk{?ids}\",    \"PackageUpload\": \"/api/packages/raw{?replace}\",    \"ProjectGroups\": \"/api/projectgroups{/id}{?skip}\",    \"Projects\": \"/api/projects{/id}{?skip,clone}\",    \"ProjectPulse\": \"/api/projects/pulse{?projectIds}\",    \"Register\": \"/api/users/register\",    \"Releases\": \"/api/releases{/id}{?skip,ignoreChannelRules}\",    \"ServerStatus\": \"/api/serverstatus\",    \"SignIn\": \"/api/users/login{?returnUrl}\",    \"SignOut\": \"/api/users/logout\",    \"RetentionPolicies\": \"/api/retentionpolicies{/id}{?skip}\",    \"SmtpConfiguration\": \"/api/smtpconfiguration\",    \"Tasks\": \"/api/tasks{/id}{?skip,active,environment,project,name,node,running}\",    \"Teams\": \"/api/teams{/id}{?skip}\",    \"UserRoles\": \"/api/userroles{/id}{?skip}\",    \"Users\": \"/api/users{/id}{?skip}\",    \"PermissionDescriptions\": \"/api/permissions/all\",    \"Variables\": \"/api/variables{/id}\",    \"VariableNames\": \"/api/variables/names{?project}\",    \"VersionRuleTest\": \"/api/channels/rule-test{?version,versionRange,preReleaseTag}\",    \"Reporting/DeploymentsCountedByWeek\": \"/api/reporting/deployments-counted-by-week{?projectIds}\",    \"RepositoryConfiguration\": \"/api/repository/configuration\",    \"Web\": \"/app\"  }}";
      }
      if (s.equals(octopusUrl + "/api/projects")) {
        return "{\"ItemType\": \"Project\",\"IsStale\": false,\"TotalResults\": 1,\"ItemsPerPage\": 30,\"Items\": [{\"Id\": \"Projects-1\",\"VariableSetId\": \"variableset-Projects-1\",\"DeploymentProcessId\": \"deploymentprocess-Projects-1\",\"IncludedLibraryVariableSetIds\": [],\"DefaultToSkipIfAlreadyInstalled\": false,\"VersioningStrategy\": {\"DonorPackageStepId\": null,\"Template\": \"#{Octopus.Version.LastMajor}.#{Octopus.Version.LastMinor}.#{Octopus.Version.NextPatch}\"},\"ReleaseCreationStrategy\": {\"ReleaseCreationPackageStepId\": null,\"ChannelId\": null},\"Name\": \"TestProject\",\"Slug\": \"testproject\",\"Description\": \"\",\"IsDisabled\": false,\"ProjectGroupId\": \"ProjectGroups-1\",\"LifecycleId\": \"Lifecycles-1\",\"AutoCreateRelease\": false,\"Links\": {\"Self\": \"/api/projects/Projects-1\",\"Releases\": \"/api/projects/Projects-1/releases{/version}{?skip}\",\"Channels\": \"/api/projects/Projects-1/channels\",\"OrderChannels\": \"/api/projects/Projects-1/channels/order\",\"Variables\": \"/api/variables/variableset-Projects-1\",\"Progression\": \"/api/progression/Projects-1\",\"DeploymentProcess\": \"/api/deploymentprocesses/deploymentprocess-Projects-1\",\"Web\": \"/app#/projects/Projects-1\",\"Logo\": \"/api/projects/Projects-1/logo\"}}],\"Links\": {\"Self\": \"/api/projects\",\"Template\": \"/api/projects{?skip}\",\"Page.Current\": \"/api/projects?skip=0\",\"Page.0\": \"/api/projects?skip=0\"}}";
      }
      //page 1 of the deployments for 'projects-1'
      if (s.equals(octopusUrl + "/api/deployments?Projects=Projects-1")) {
        return "{\"ItemType\":\"Deployment\",\"IsStale\":false,\"TotalResults\":3,\"ItemsPerPage\":2,\"Items\":[{\"Id\":\"Deployments-41\",\"ReleaseId\":\"Releases-22\",\"EnvironmentId\":\"Environments-1\",\"ForcePackageDownload\":false,\"ForcePackageRedeployment\":false,\"SkipActions\":[],\"SpecificMachineIds\":[],\"DeploymentProcessId\":\"deploymentprocess-Projects-1-s-4-NH2MN\",\"ManifestVariableSetId\":\"variableset-Deployments-41\",\"TaskId\":\"ServerTasks-76\",\"ProjectId\":\"Projects-1\",\"UseGuidedFailure\":true,\"Comments\":null,\"FormValues\":{},\"QueueTime\":null,\"Name\":\"Deploy to local (#2)\",\"Created\":\"2015-12-08T08:09:39.624+00:00\",\"Links\":{\"Self\":\"/api/deployments/Deployments-41\",\"Release\":\"/api/releases/Releases-22\",\"Environment\":\"/api/environments/Environments-1\",\"Project\":\"/api/projects/Projects-1\",\"Task\":\"/api/tasks/ServerTasks-76\",\"Web\":\"/app#/deployments/Deployments-41\",\"Artifacts\":\"/api/artifacts?regarding=Deployments-41\",\"Variables\":\"/api/variables/variableset-Deployments-41\",\"Interruptions\":\"/api/interruptions?regarding=Deployments-41\"}},{\"Id\":\"Deployments-22\",\"ReleaseId\":\"Releases-22\",\"EnvironmentId\":\"Environments-1\",\"ForcePackageDownload\":false,\"ForcePackageRedeployment\":false,\"SkipActions\":[],\"SpecificMachineIds\":[],\"DeploymentProcessId\":\"deploymentprocess-Projects-1-s-4-NH2MN\",\"ManifestVariableSetId\":\"variableset-Deployments-22\",\"TaskId\":\"ServerTasks-43\",\"ProjectId\":\"Projects-1\",\"UseGuidedFailure\":true,\"Comments\":null,\"FormValues\":{},\"QueueTime\":null,\"Name\":\"Deploy to local\",\"Created\":\"2015-11-12T09:58:33.113+00:00\",\"Links\":{\"Self\":\"/api/deployments/Deployments-22\",\"Release\":\"/api/releases/Releases-22\",\"Environment\":\"/api/environments/Environments-1\",\"Project\":\"/api/projects/Projects-1\",\"Task\":\"/api/tasks/ServerTasks-43\",\"Web\":\"/app#/deployments/Deployments-22\",\"Artifacts\":\"/api/artifacts?regarding=Deployments-22\",\"Variables\":\"/api/variables/variableset-Deployments-22\",\"Interruptions\":\"/api/interruptions?regarding=Deployments-22\"}}],\"Links\":{\"Self\":\"/api/deployments?projects=Projects-1\",\"Template\":\"/api/deployments{?skip,take,projects,environments,taskState}\",\"Page.Next\":\"/api/deployments?skip=2&projects=Projects-1\",\"Page.Current\":\"/api/deployments?skip=0&projects=Projects-1\",\"Page.0\":\"/api/deployments?skip=0&projects=Projects-1\",\"Page.1\":\"/api/deployments?skip=2&projects=Projects-1\"}}";
      }
      //page 2 of the deployments for 'projects-1'
      if (s.equals(octopusUrl + "/api/deployments?skip=2&projects=Projects-1")) {
        return "{\"ItemType\":\"Deployment\",\"IsStale\":false,\"TotalResults\":3,\"ItemsPerPage\":2,\"Items\":[{\"Id\":\"Deployments-4\",\"ReleaseId\":\"Releases-1\",\"EnvironmentId\":\"Environments-1\",\"ForcePackageDownload\":false,\"ForcePackageRedeployment\":false,\"SkipActions\":[],\"SpecificMachineIds\":[],\"DeploymentProcessId\":\"deploymentprocess-Projects-1-s-3-ULBZF\",\"ManifestVariableSetId\":\"variableset-Deployments-4\",\"TaskId\":\"ServerTasks-21\",\"ProjectId\":\"Projects-1\",\"UseGuidedFailure\":true,\"Comments\":null,\"FormValues\":{},\"QueueTime\":null,\"Name\":\"Deploy to local (#4)\",\"Created\":\"2015-11-12T09:22:00.865+00:00\",\"Links\":{\"Self\":\"/api/deployments/Deployments-4\",\"Release\":\"/api/releases/Releases-1\",\"Environment\":\"/api/environments/Environments-1\",\"Project\":\"/api/projects/Projects-1\",\"Task\":\"/api/tasks/ServerTasks-21\",\"Web\":\"/app#/deployments/Deployments-4\",\"Artifacts\":\"/api/artifacts?regarding=Deployments-4\",\"Variables\":\"/api/variables/variableset-Deployments-4\",\"Interruptions\":\"/api/interruptions?regarding=Deployments-4\"}}],\"Links\":{\"Self\":\"/api/deployments?projects=Projects-1\",\"Template\":\"/api/deployments{?skip,take,projects,environments,taskState}\",\"Page.Previous\":\"/api/deployments?skip=0&projects=Projects-1\",\"Page.Current\":\"/api/deployments?skip=2&projects=Projects-1\",\"Page.0\":\"/api/deployments?skip=0&projects=Projects-1\",\"Page.1\":\"/api/deployments?skip=2&projects=Projects-1\"}}";
      }
      //3rd (most recent) deployment for 'projects-1' - failed
      if (s.equals(octopusUrl + "/api/tasks/ServerTasks-76")) {
        return "{\"Id\": \"ServerTasks-76\",\"Name\": \"Deploy\",\"Description\": \"Deploy TestProject release 0.0.5 to local\",\"Arguments\": {\"DeploymentId\": \"Deployments-41\"},\"State\": \"Failed\",\"Completed\": \"09 December 2015 17:31\",\"QueueTime\": \"2015-12-08T08:09:39.546+00:00\",\"StartTime\": \"2015-12-08T08:09:40.046+00:00\",\"LastUpdatedTime\": \"2015-12-09T17:31:36.402+00:00\",\"CompletedTime\": \"2015-12-09T17:31:36.402+00:00\",\"ServerNode\": \"DESKTOP-4VQNCHP\",\"Duration\": \"1 day\",\"ErrorMessage\": \"The deployment failed because one or more steps failed. Please see the deployment log for details.\",\"HasBeenPickedUpByProcessor\": true,\"IsCompleted\": true,\"FinishedSuccessfully\": false,\"HasPendingInterruptions\": true,\"CanRerun\": false,\"HasWarningsOrErrors\": true,\"Links\": {\"Self\": \"/api/tasks/ServerTasks-76\",\"Web\": \"/app#/tasks/ServerTasks-76\",\"Raw\": \"/api/tasks/ServerTasks-76/raw\",\"Rerun\": \"/api/tasks/rerun/ServerTasks-76\",\"Cancel\": \"/api/tasks/ServerTasks-76/cancel\",\"QueuedBehind\": \"/api/tasks/ServerTasks-76/queued-behind\",\"Details\": \"/api/tasks/ServerTasks-76/details{?verbose,tail}\",\"Artifacts\": \"/api/artifacts?regarding=ServerTasks-76\",\"Interruptions\": \"/api/tasks\"}}";
      }
      //2nd deployment for 'projects-1' - failed
      if (s.equals(octopusUrl + "/api/tasks/ServerTasks-43")) {
        return "{\"Id\": \"ServerTasks-43\",\"Name\": \"Deploy\",\"Description\": \"Deploy TestProject release 0.0.5 to local\",\"Arguments\": {\"DeploymentId\": \"Deployments-22\"},\"State\": \"Failed\",\"Completed\": \"12 November 2015 09:59\",\"QueueTime\": \"2015-11-12T09:58:33.099+00:00\",\"StartTime\": \"2015-11-12T09:58:33.899+00:00\",\"LastUpdatedTime\": \"2015-11-12T09:59:07.071+00:00\",\"CompletedTime\": \"2015-11-12T09:59:07.071+00:00\",\"ServerNode\": \"DESKTOP-4VQNCHP\",\"Duration\": \"33 seconds\",\"ErrorMessage\": \"The deployment failed because one or more steps failed. Please see the deployment log for details.\",\"HasBeenPickedUpByProcessor\": true,\"IsCompleted\": true,\"FinishedSuccessfully\": false,\"HasPendingInterruptions\": true,\"CanRerun\": false,\"HasWarningsOrErrors\": true,\"Links\": {\"Self\": \"/api/tasks/ServerTasks-43\",\"Web\": \"/app#/tasks/ServerTasks-43\",\"Raw\": \"/api/tasks/ServerTasks-43/raw\",\"Rerun\": \"/api/tasks/rerun/ServerTasks-43\",\"Cancel\": \"/api/tasks/ServerTasks-43/cancel\",\"QueuedBehind\": \"/api/tasks/ServerTasks-43/queued-behind\",\"Details\": \"/api/tasks/ServerTasks-43/details{?verbose,tail}\",\"Artifacts\": \"/api/artifacts?regarding=ServerTasks-43\",\"Interruptions\": \"/api/tasks\"}}";
      }
      //1st deployment for 'projects-1' - success
      if (s.equals(octopusUrl + "/api/tasks/ServerTasks-21")) {
        return "{\"Id\": \"ServerTasks-21\",\"Name\": \"Deploy\",\"Description\": \"Deploy TestProject release 0.0.1 to local\",\"Arguments\": {\"DeploymentId\": \"Deployments-4\"},\"State\": \"Success\",\"Completed\": \"12 November 2015 09:22\",\"QueueTime\": \"2015-11-12T09:22:00.558+00:00\",\"StartTime\": \"2015-11-12T09:22:03.731+00:00\",\"LastUpdatedTime\": \"2015-11-12T09:22:45.599+00:00\",\"CompletedTime\": \"2015-11-12T09:22:45.599+00:00\",\"ServerNode\": \"DESKTOP-4VQNCHP\",\"Duration\": \"42 seconds\",\"ErrorMessage\": \"\",\"HasBeenPickedUpByProcessor\": true,\"IsCompleted\": true,\"FinishedSuccessfully\": true,\"HasPendingInterruptions\": false,\"CanRerun\": false,\"HasWarningsOrErrors\": false,\"Links\": {\"Self\": \"/api/tasks/ServerTasks-21\",\"Web\": \"/app#/tasks/ServerTasks-21\",\"Raw\": \"/api/tasks/ServerTasks-21/raw\",\"Rerun\": \"/api/tasks/rerun/ServerTasks-21\",\"Cancel\": \"/api/tasks/ServerTasks-21/cancel\",\"QueuedBehind\": \"/api/tasks/ServerTasks-21/queued-behind\",\"Details\": \"/api/tasks/ServerTasks-21/details{?verbose,tail}\",\"Artifacts\": \"/api/artifacts?regarding=ServerTasks-21\",\"Interruptions\": \"/api/tasks\"}}";
      }
      return null;
    }

    public void init(URI uri, String octopusApiKey, Integer connectionTimeout) throws KeyStoreException, NoSuchAlgorithmException, KeyManagementException {
      //no-op
    }
  }

  private class FakeContentProvider implements HttpContentProvider {
    public void close(@Nullable Closeable closeable) {
      //no-op
    }

    public String getContent(URI uri) throws IOException {
      String s = uri.toString();
      if (s.equals(octopusUrl + "/api")) {
        return "{  \"Application\": \"Octopus Deploy\",  \"Version\": \"3.2.1\",  \"ApiVersion\": \"3.0.0\",  \"FormsLoginEnabled\": true,  \"Links\": {    \"Self\": \"/api\",    \"Accounts\": \"/api/accounts{/id}{?skip}\",    \"ActionTemplates\": \"/api/actiontemplates{/id}{?skip}\",    \"Alerts\": \"/api/alerts{/id}{?skip}\",    \"Artifacts\": \"/api/artifacts{/id}{?skip,regarding}\",    \"Channels\": \"/api/channels{/id}\",    \"Certificates\": \"/api/certificates{/id}{?skip}\",    \"CurrentUser\": \"/api/users/me\",    \"CurrentLicense\": \"/api/licenses/licenses-current\",    \"Dashboard\": \"/api/dashboard\",    \"DashboardConfiguration\": \"/api/dashboardconfiguration\",    \"DashboardDynamic\": \"/api/dashboard/dynamic{?projects,environments,includePrevious}\",    \"DeploymentProcesses\": \"/api/deploymentprocesses{/id}\",    \"Deployments\": \"/api/deployments{/id}{?skip,take,projects,environments,taskState}\",    \"DiscoverMachine\": \"/api/machines/discover{?host,port,type}\",    \"Environments\": \"/api/environments{/id}{?skip}\",    \"EnvironmentSortOrder\": \"/api/environments/sortorder\",    \"Events\": \"/api/events{/id}{?skip,regarding,modifier,user,from,to}\",    \"ExternalSecurityGroups\": \"/api/externalsecuritygroups{/id}{?name}\",    \"Feeds\": \"/api/feeds{/id}{?skip}\",    \"Interruptions\": \"/api/interruptions{/id}{?skip,regarding,pendingOnly}\",    \"Invitations\": \"/api/users/invitations\",    \"LibraryVariables\": \"/api/libraryvariablesets{/id}{?skip,contentType}\",    \"Lifecycles\": \"/api/lifecycles{/id}{?skip}\",    \"MachineRoles\": \"/api/machineroles/all\",    \"Machines\": \"/api/machines{/id}{?skip,thumbprint}\",    \"MaintenanceConfiguration\": \"/api/maintenanceconfiguration\",    \"OctopusServerNodes\": \"/api/octopusservernodes{/id}\",    \"Packages\": \"/api/packages{/id}{?nuGetPackageId,filter,latest,skip,take,includeNotes}\",    \"PackagesBulk\": \"/api/packages/bulk{?ids}\",    \"PackageUpload\": \"/api/packages/raw{?replace}\",    \"ProjectGroups\": \"/api/projectgroups{/id}{?skip}\",    \"Projects\": \"/api/projects{/id}{?skip,clone}\",    \"ProjectPulse\": \"/api/projects/pulse{?projectIds}\",    \"Register\": \"/api/users/register\",    \"Releases\": \"/api/releases{/id}{?skip,ignoreChannelRules}\",    \"ServerStatus\": \"/api/serverstatus\",    \"SignIn\": \"/api/users/login{?returnUrl}\",    \"SignOut\": \"/api/users/logout\",    \"RetentionPolicies\": \"/api/retentionpolicies{/id}{?skip}\",    \"SmtpConfiguration\": \"/api/smtpconfiguration\",    \"Tasks\": \"/api/tasks{/id}{?skip,active,environment,project,name,node,running}\",    \"Teams\": \"/api/teams{/id}{?skip}\",    \"UserRoles\": \"/api/userroles{/id}{?skip}\",    \"Users\": \"/api/users{/id}{?skip}\",    \"PermissionDescriptions\": \"/api/permissions/all\",    \"Variables\": \"/api/variables{/id}\",    \"VariableNames\": \"/api/variables/names{?project}\",    \"VersionRuleTest\": \"/api/channels/rule-test{?version,versionRange,preReleaseTag}\",    \"Reporting/DeploymentsCountedByWeek\": \"/api/reporting/deployments-counted-by-week{?projectIds}\",    \"RepositoryConfiguration\": \"/api/repository/configuration\",    \"Web\": \"/app\"  }}";
      }
      if (s.equals(octopusUrl + "/api/projects")) {
        return "{\"ItemType\": \"Project\",\"IsStale\": false,\"TotalResults\": 1,\"ItemsPerPage\": 30,\"Items\": [{\"Id\": \"Projects-1\",\"VariableSetId\": \"variableset-Projects-1\",\"DeploymentProcessId\": \"deploymentprocess-Projects-1\",\"IncludedLibraryVariableSetIds\": [],\"DefaultToSkipIfAlreadyInstalled\": false,\"VersioningStrategy\": {\"DonorPackageStepId\": null,\"Template\": \"#{Octopus.Version.LastMajor}.#{Octopus.Version.LastMinor}.#{Octopus.Version.NextPatch}\"},\"ReleaseCreationStrategy\": {\"ReleaseCreationPackageStepId\": null,\"ChannelId\": null},\"Name\": \"TestProject\",\"Slug\": \"testproject\",\"Description\": \"\",\"IsDisabled\": false,\"ProjectGroupId\": \"ProjectGroups-1\",\"LifecycleId\": \"Lifecycles-1\",\"AutoCreateRelease\": false,\"Links\": {\"Self\": \"/api/projects/Projects-1\",\"Releases\": \"/api/projects/Projects-1/releases{/version}{?skip}\",\"Channels\": \"/api/projects/Projects-1/channels\",\"OrderChannels\": \"/api/projects/Projects-1/channels/order\",\"Variables\": \"/api/variables/variableset-Projects-1\",\"Progression\": \"/api/progression/Projects-1\",\"DeploymentProcess\": \"/api/deploymentprocesses/deploymentprocess-Projects-1\",\"Web\": \"/app#/projects/Projects-1\",\"Logo\": \"/api/projects/Projects-1/logo\"}}],\"Links\": {\"Self\": \"/api/projects\",\"Template\": \"/api/projects{?skip}\",\"Page.Current\": \"/api/projects?skip=0\",\"Page.0\": \"/api/projects?skip=0\"}}";
      }
      if (s.equals(octopusUrl + "/api/deployments?Projects=Projects-1")) {
        return "{\"ItemType\": \"Deployment\",\"IsStale\": false,\"TotalResults\": 10,\"ItemsPerPage\": 30,\"Items\": [{\"Id\": \"Deployments-41\",\"ReleaseId\": \"Releases-22\",\"EnvironmentId\": \"Environments-1\",\"ForcePackageDownload\": false,\"ForcePackageRedeployment\": false,\"SkipActions\": [],\"SpecificMachineIds\": [],\"DeploymentProcessId\": \"deploymentprocess-Projects-1-s-4-NH2MN\",\"ManifestVariableSetId\": \"variableset-Deployments-41\",\"TaskId\": \"ServerTasks-76\",\"ProjectId\": \"Projects-1\",\"UseGuidedFailure\": true,\"Comments\": null,\"FormValues\": {},\"QueueTime\": null,\"Name\": \"Deploy to local (#2)\",\"Created\": \"2015-12-08T08:09:39.624+00:00\",\"Links\": {\"Self\": \"/api/deployments/Deployments-41\",\"Release\": \"/api/releases/Releases-22\",\"Environment\": \"/api/environments/Environments-1\",\"Project\": \"/api/projects/Projects-1\",\"Task\": \"/api/tasks/ServerTasks-76\",\"Web\": \"/app#/deployments/Deployments-41\",\"Artifacts\": \"/api/artifacts?regarding=Deployments-41\",\"Variables\": \"/api/variables/variableset-Deployments-41\",\"Interruptions\": \"/api/interruptions?regarding=Deployments-41\"}},{\"Id\": \"Deployments-22\",\"ReleaseId\": \"Releases-22\",\"EnvironmentId\": \"Environments-1\",\"ForcePackageDownload\": false,\"ForcePackageRedeployment\": false,\"SkipActions\": [],\"SpecificMachineIds\": [],\"DeploymentProcessId\": \"deploymentprocess-Projects-1-s-4-NH2MN\",\"ManifestVariableSetId\": \"variableset-Deployments-22\",\"TaskId\": \"ServerTasks-43\",\"ProjectId\": \"Projects-1\",\"UseGuidedFailure\": true,\"Comments\": null,\"FormValues\": {},\"QueueTime\": null,\"Name\": \"Deploy to local\",\"Created\": \"2015-11-12T09:58:33.113+00:00\",\"Links\": {\"Self\": \"/api/deployments/Deployments-22\",\"Release\": \"/api/releases/Releases-22\",\"Environment\": \"/api/environments/Environments-1\",\"Project\": \"/api/projects/Projects-1\",\"Task\": \"/api/tasks/ServerTasks-43\",\"Web\": \"/app#/deployments/Deployments-22\",\"Artifacts\": \"/api/artifacts?regarding=Deployments-22\",\"Variables\": \"/api/variables/variableset-Deployments-22\",\"Interruptions\": \"/api/interruptions?regarding=Deployments-22\"}},{\"Id\": \"Deployments-4\",\"ReleaseId\": \"Releases-1\",\"EnvironmentId\": \"Environments-1\",\"ForcePackageDownload\": false,\"ForcePackageRedeployment\": false,\"SkipActions\": [],\"SpecificMachineIds\": [],\"DeploymentProcessId\": \"deploymentprocess-Projects-1-s-3-ULBZF\",\"ManifestVariableSetId\": \"variableset-Deployments-4\",\"TaskId\": \"ServerTasks-21\",\"ProjectId\": \"Projects-1\",\"UseGuidedFailure\": true,\"Comments\": null,\"FormValues\": {},\"QueueTime\": null,\"Name\": \"Deploy to local (#4)\",\"Created\": \"2015-11-12T09:22:00.865+00:00\",\"Links\": {\"Self\": \"/api/deployments/Deployments-4\",\"Release\": \"/api/releases/Releases-1\",\"Environment\": \"/api/environments/Environments-1\",\"Project\": \"/api/projects/Projects-1\",\"Task\": \"/api/tasks/ServerTasks-21\",\"Web\": \"/app#/deployments/Deployments-4\",\"Artifacts\": \"/api/artifacts?regarding=Deployments-4\",\"Variables\": \"/api/variables/variableset-Deployments-4\",\"Interruptions\": \"/api/interruptions?regarding=Deployments-4\"}},{\"Id\": \"Deployments-3\",\"ReleaseId\": \"Releases-1\",\"EnvironmentId\": \"Environments-1\",\"ForcePackageDownload\": false,\"ForcePackageRedeployment\": false,\"SkipActions\": [],\"SpecificMachineIds\": [],\"DeploymentProcessId\": \"deploymentprocess-Projects-1-s-3-ULBZF\",\"ManifestVariableSetId\": \"variableset-Deployments-3\",\"TaskId\": \"ServerTasks-20\",\"ProjectId\": \"Projects-1\",\"UseGuidedFailure\": false,\"Comments\": null,\"FormValues\": {},\"QueueTime\": null,\"Name\": \"Deploy to local (#3)\",\"Created\": \"2015-11-12T09:19:40.542+00:00\",\"Links\": {\"Self\": \"/api/deployments/Deployments-3\",\"Release\": \"/api/releases/Releases-1\",\"Environment\": \"/api/environments/Environments-1\",\"Project\": \"/api/projects/Projects-1\",\"Task\": \"/api/tasks/ServerTasks-20\",\"Web\": \"/app#/deployments/Deployments-3\",\"Artifacts\": \"/api/artifacts?regarding=Deployments-3\",\"Variables\": \"/api/variables/variableset-Deployments-3\",\"Interruptions\": \"/api/interruptions?regarding=Deployments-3\"}},{\"Id\": \"Deployments-2\",\"ReleaseId\": \"Releases-1\",\"EnvironmentId\": \"Environments-1\",\"ForcePackageDownload\": false,\"ForcePackageRedeployment\": false,\"SkipActions\": [],\"SpecificMachineIds\": [],\"DeploymentProcessId\": \"deploymentprocess-Projects-1-s-3-ULBZF\",\"ManifestVariableSetId\": \"variableset-Deployments-2\",\"TaskId\": \"ServerTasks-19\",\"ProjectId\": \"Projects-1\",\"UseGuidedFailure\": false,\"Comments\": null,\"FormValues\": {},\"QueueTime\": null,\"Name\": \"Deploy to local (#2)\",\"Created\": \"2015-11-12T09:07:24.473+00:00\",\"Links\": {\"Self\": \"/api/deployments/Deployments-2\",\"Release\": \"/api/releases/Releases-1\",\"Environment\": \"/api/environments/Environments-1\",\"Project\": \"/api/projects/Projects-1\",\"Task\": \"/api/tasks/ServerTasks-19\",\"Web\": \"/app#/deployments/Deployments-2\",\"Artifacts\": \"/api/artifacts?regarding=Deployments-2\",\"Variables\": \"/api/variables/variableset-Deployments-2\",\"Interruptions\": \"/api/interruptions?regarding=Deployments-2\"}},{\"Id\": \"Deployments-1\",\"ReleaseId\": \"Releases-1\",\"EnvironmentId\": \"Environments-1\",\"ForcePackageDownload\": false,\"ForcePackageRedeployment\": false,\"SkipActions\": [],\"SpecificMachineIds\": [],\"DeploymentProcessId\": \"deploymentprocess-Projects-1-s-3-ULBZF\",\"ManifestVariableSetId\": \"variableset-Deployments-1\",\"TaskId\": \"ServerTasks-17\",\"ProjectId\": \"Projects-1\",\"UseGuidedFailure\": false,\"Comments\": null,\"FormValues\": {},\"QueueTime\": null,\"Name\": \"Deploy to local\",\"Created\": \"2015-11-12T08:30:24.194+00:00\",\"Links\": {\"Self\": \"/api/deployments/Deployments-1\",\"Release\": \"/api/releases/Releases-1\",\"Environment\": \"/api/environments/Environments-1\",\"Project\": \"/api/projects/Projects-1\",\"Task\": \"/api/tasks/ServerTasks-17\",\"Web\": \"/app#/deployments/Deployments-1\",\"Artifacts\": \"/api/artifacts?regarding=Deployments-1\",\"Variables\": \"/api/variables/variableset-Deployments-1\",\"Interruptions\": \"/api/interruptions?regarding=Deployments-1\"}}],\"Links\": {\"Self\": \"/api/deployments?projects=Projects-1\",\"Template\": \"/api/deployments{?skip,take,projects,environments,taskState}\",\"Page.Current\": \"/api/deployments?skip=0&projects=Projects-1\",\"Page.0\": \"/api/deployments?skip=0&projects=Projects-1\"}}";
      }
      if (s.equals(octopusUrl + "/api/tasks/ServerTasks-76")) {
        return "{\"Id\": \"ServerTasks-76\",\"Name\": \"Deploy\",\"Description\": \"Deploy TestProject release 0.0.5 to local\",\"Arguments\": {\"DeploymentId\": \"Deployments-41\"},\"State\": \"Failed\",\"Completed\": \"09 December 2015 17:31\",\"QueueTime\": \"2015-12-08T08:09:39.546+00:00\",\"StartTime\": \"2015-12-08T08:09:40.046+00:00\",\"LastUpdatedTime\": \"2015-12-09T17:31:36.402+00:00\",\"CompletedTime\": \"2015-12-09T17:31:36.402+00:00\",\"ServerNode\": \"DESKTOP-4VQNCHP\",\"Duration\": \"1 day\",\"ErrorMessage\": \"The deployment failed because one or more steps failed. Please see the deployment log for details.\",\"HasBeenPickedUpByProcessor\": true,\"IsCompleted\": true,\"FinishedSuccessfully\": false,\"HasPendingInterruptions\": true,\"CanRerun\": false,\"HasWarningsOrErrors\": true,\"Links\": {\"Self\": \"/api/tasks/ServerTasks-76\",\"Web\": \"/app#/tasks/ServerTasks-76\",\"Raw\": \"/api/tasks/ServerTasks-76/raw\",\"Rerun\": \"/api/tasks/rerun/ServerTasks-76\",\"Cancel\": \"/api/tasks/ServerTasks-76/cancel\",\"QueuedBehind\": \"/api/tasks/ServerTasks-76/queued-behind\",\"Details\": \"/api/tasks/ServerTasks-76/details{?verbose,tail}\",\"Artifacts\": \"/api/artifacts?regarding=ServerTasks-76\",\"Interruptions\": \"/api/tasks\"}}";
      }
      if (s.equals(octopusUrl + "/api/tasks/ServerTasks-43")) {
        return "{\"Id\": \"ServerTasks-43\",\"Name\": \"Deploy\",\"Description\": \"Deploy TestProject release 0.0.5 to local\",\"Arguments\": {\"DeploymentId\": \"Deployments-22\"},\"State\": \"Failed\",\"Completed\": \"12 November 2015 09:59\",\"QueueTime\": \"2015-11-12T09:58:33.099+00:00\",\"StartTime\": \"2015-11-12T09:58:33.899+00:00\",\"LastUpdatedTime\": \"2015-11-12T09:59:07.071+00:00\",\"CompletedTime\": \"2015-11-12T09:59:07.071+00:00\",\"ServerNode\": \"DESKTOP-4VQNCHP\",\"Duration\": \"33 seconds\",\"ErrorMessage\": \"The deployment failed because one or more steps failed. Please see the deployment log for details.\",\"HasBeenPickedUpByProcessor\": true,\"IsCompleted\": true,\"FinishedSuccessfully\": false,\"HasPendingInterruptions\": true,\"CanRerun\": false,\"HasWarningsOrErrors\": true,\"Links\": {\"Self\": \"/api/tasks/ServerTasks-43\",\"Web\": \"/app#/tasks/ServerTasks-43\",\"Raw\": \"/api/tasks/ServerTasks-43/raw\",\"Rerun\": \"/api/tasks/rerun/ServerTasks-43\",\"Cancel\": \"/api/tasks/ServerTasks-43/cancel\",\"QueuedBehind\": \"/api/tasks/ServerTasks-43/queued-behind\",\"Details\": \"/api/tasks/ServerTasks-43/details{?verbose,tail}\",\"Artifacts\": \"/api/artifacts?regarding=ServerTasks-43\",\"Interruptions\": \"/api/tasks\"}}";
      }
      if (s.equals(octopusUrl + "/api/tasks/ServerTasks-21")) {
        return "{\"Id\": \"ServerTasks-21\",\"Name\": \"Deploy\",\"Description\": \"Deploy TestProject release 0.0.1 to local\",\"Arguments\": {\"DeploymentId\": \"Deployments-4\"},\"State\": \"Success\",\"Completed\": \"12 November 2015 09:22\",\"QueueTime\": \"2015-11-12T09:22:00.558+00:00\",\"StartTime\": \"2015-11-12T09:22:03.731+00:00\",\"LastUpdatedTime\": \"2015-11-12T09:22:45.599+00:00\",\"CompletedTime\": \"2015-11-12T09:22:45.599+00:00\",\"ServerNode\": \"DESKTOP-4VQNCHP\",\"Duration\": \"42 seconds\",\"ErrorMessage\": \"\",\"HasBeenPickedUpByProcessor\": true,\"IsCompleted\": true,\"FinishedSuccessfully\": true,\"HasPendingInterruptions\": false,\"CanRerun\": false,\"HasWarningsOrErrors\": false,\"Links\": {\"Self\": \"/api/tasks/ServerTasks-21\",\"Web\": \"/app#/tasks/ServerTasks-21\",\"Raw\": \"/api/tasks/ServerTasks-21/raw\",\"Rerun\": \"/api/tasks/rerun/ServerTasks-21\",\"Cancel\": \"/api/tasks/ServerTasks-21/cancel\",\"QueuedBehind\": \"/api/tasks/ServerTasks-21/queued-behind\",\"Details\": \"/api/tasks/ServerTasks-21/details{?verbose,tail}\",\"Artifacts\": \"/api/artifacts?regarding=ServerTasks-21\",\"Interruptions\": \"/api/tasks\"}}";
      }
      return null;
    }

    public void init(URI uri, String octopusApiKey, Integer connectionTimeout) throws KeyStoreException, NoSuchAlgorithmException, KeyManagementException {
      //no-op
    }
  }

  private class FakeContentProviderWithMultipleEnvironments implements HttpContentProvider {
    public void close(@Nullable Closeable closeable) {
      //no-op
    }

    public String getContent(URI uri) throws IOException {
      String s = uri.toString();
      if (s.equals(octopusUrl + "/api")) {
        return "{  \"Application\": \"Octopus Deploy\",  \"Version\": \"3.2.1\",  \"ApiVersion\": \"3.0.0\",  \"FormsLoginEnabled\": true,  \"Links\": {    \"Self\": \"/api\",    \"Accounts\": \"/api/accounts{/id}{?skip}\",    \"ActionTemplates\": \"/api/actiontemplates{/id}{?skip}\",    \"Alerts\": \"/api/alerts{/id}{?skip}\",    \"Artifacts\": \"/api/artifacts{/id}{?skip,regarding}\",    \"Channels\": \"/api/channels{/id}\",    \"Certificates\": \"/api/certificates{/id}{?skip}\",    \"CurrentUser\": \"/api/users/me\",    \"CurrentLicense\": \"/api/licenses/licenses-current\",    \"Dashboard\": \"/api/dashboard\",    \"DashboardConfiguration\": \"/api/dashboardconfiguration\",    \"DashboardDynamic\": \"/api/dashboard/dynamic{?projects,environments,includePrevious}\",    \"DeploymentProcesses\": \"/api/deploymentprocesses{/id}\",    \"Deployments\": \"/api/deployments{/id}{?skip,take,projects,environments,taskState}\",    \"DiscoverMachine\": \"/api/machines/discover{?host,port,type}\",    \"Environments\": \"/api/environments{/id}{?skip}\",    \"EnvironmentSortOrder\": \"/api/environments/sortorder\",    \"Events\": \"/api/events{/id}{?skip,regarding,modifier,user,from,to}\",    \"ExternalSecurityGroups\": \"/api/externalsecuritygroups{/id}{?name}\",    \"Feeds\": \"/api/feeds{/id}{?skip}\",    \"Interruptions\": \"/api/interruptions{/id}{?skip,regarding,pendingOnly}\",    \"Invitations\": \"/api/users/invitations\",    \"LibraryVariables\": \"/api/libraryvariablesets{/id}{?skip,contentType}\",    \"Lifecycles\": \"/api/lifecycles{/id}{?skip}\",    \"MachineRoles\": \"/api/machineroles/all\",    \"Machines\": \"/api/machines{/id}{?skip,thumbprint}\",    \"MaintenanceConfiguration\": \"/api/maintenanceconfiguration\",    \"OctopusServerNodes\": \"/api/octopusservernodes{/id}\",    \"Packages\": \"/api/packages{/id}{?nuGetPackageId,filter,latest,skip,take,includeNotes}\",    \"PackagesBulk\": \"/api/packages/bulk{?ids}\",    \"PackageUpload\": \"/api/packages/raw{?replace}\",    \"ProjectGroups\": \"/api/projectgroups{/id}{?skip}\",    \"Projects\": \"/api/projects{/id}{?skip,clone}\",    \"ProjectPulse\": \"/api/projects/pulse{?projectIds}\",    \"Register\": \"/api/users/register\",    \"Releases\": \"/api/releases{/id}{?skip,ignoreChannelRules}\",    \"ServerStatus\": \"/api/serverstatus\",    \"SignIn\": \"/api/users/login{?returnUrl}\",    \"SignOut\": \"/api/users/logout\",    \"RetentionPolicies\": \"/api/retentionpolicies{/id}{?skip}\",    \"SmtpConfiguration\": \"/api/smtpconfiguration\",    \"Tasks\": \"/api/tasks{/id}{?skip,active,environment,project,name,node,running}\",    \"Teams\": \"/api/teams{/id}{?skip}\",    \"UserRoles\": \"/api/userroles{/id}{?skip}\",    \"Users\": \"/api/users{/id}{?skip}\",    \"PermissionDescriptions\": \"/api/permissions/all\",    \"Variables\": \"/api/variables{/id}\",    \"VariableNames\": \"/api/variables/names{?project}\",    \"VersionRuleTest\": \"/api/channels/rule-test{?version,versionRange,preReleaseTag}\",    \"Reporting/DeploymentsCountedByWeek\": \"/api/reporting/deployments-counted-by-week{?projectIds}\",    \"RepositoryConfiguration\": \"/api/repository/configuration\",    \"Web\": \"/app\"  }}";
      }
      if (s.equals(octopusUrl + "/api/projects")) {
        return "{\"ItemType\": \"Project\",\"IsStale\": false,\"TotalResults\": 1,\"ItemsPerPage\": 30,\"Items\": [{\"Id\": \"Projects-1\",\"VariableSetId\": \"variableset-Projects-1\",\"DeploymentProcessId\": \"deploymentprocess-Projects-1\",\"IncludedLibraryVariableSetIds\": [],\"DefaultToSkipIfAlreadyInstalled\": false,\"VersioningStrategy\": {\"DonorPackageStepId\": null,\"Template\": \"#{Octopus.Version.LastMajor}.#{Octopus.Version.LastMinor}.#{Octopus.Version.NextPatch}\"},\"ReleaseCreationStrategy\": {\"ReleaseCreationPackageStepId\": null,\"ChannelId\": null},\"Name\": \"TestProject\",\"Slug\": \"testproject\",\"Description\": \"\",\"IsDisabled\": false,\"ProjectGroupId\": \"ProjectGroups-1\",\"LifecycleId\": \"Lifecycles-1\",\"AutoCreateRelease\": false,\"Links\": {\"Self\": \"/api/projects/Projects-1\",\"Releases\": \"/api/projects/Projects-1/releases{/version}{?skip}\",\"Channels\": \"/api/projects/Projects-1/channels\",\"OrderChannels\": \"/api/projects/Projects-1/channels/order\",\"Variables\": \"/api/variables/variableset-Projects-1\",\"Progression\": \"/api/progression/Projects-1\",\"DeploymentProcess\": \"/api/deploymentprocesses/deploymentprocess-Projects-1\",\"Web\": \"/app#/projects/Projects-1\",\"Logo\": \"/api/projects/Projects-1/logo\"}}],\"Links\": {\"Self\": \"/api/projects\",\"Template\": \"/api/projects{?skip}\",\"Page.Current\": \"/api/projects?skip=0\",\"Page.0\": \"/api/projects?skip=0\"}}";
      }
      if (s.equals(octopusUrl + "/api/deployments?Projects=Projects-1")) {
        return "{\"ItemType\": \"Deployment\",\"IsStale\": false,\"TotalResults\": 10,\"ItemsPerPage\": 30,\"Items\": [{\"Id\": \"Deployments-41\",\"ReleaseId\": \"Releases-22\",\"EnvironmentId\": \"Environments-1\",\"ForcePackageDownload\": false,\"ForcePackageRedeployment\": false,\"SkipActions\": [],\"SpecificMachineIds\": [],\"DeploymentProcessId\": \"deploymentprocess-Projects-1-s-4-NH2MN\",\"ManifestVariableSetId\": \"variableset-Deployments-41\",\"TaskId\": \"ServerTasks-76\",\"ProjectId\": \"Projects-1\",\"UseGuidedFailure\": true,\"Comments\": null,\"FormValues\": {},\"QueueTime\": null,\"Name\": \"Deploy to local (#2)\",\"Created\": \"2015-12-08T08:09:39.624+00:00\",\"Links\": {\"Self\": \"/api/deployments/Deployments-41\",\"Release\": \"/api/releases/Releases-22\",\"Environment\": \"/api/environments/Environments-1\",\"Project\": \"/api/projects/Projects-1\",\"Task\": \"/api/tasks/ServerTasks-76\",\"Web\": \"/app#/deployments/Deployments-41\",\"Artifacts\": \"/api/artifacts?regarding=Deployments-41\",\"Variables\": \"/api/variables/variableset-Deployments-41\",\"Interruptions\": \"/api/interruptions?regarding=Deployments-41\"}},{\"Id\": \"Deployments-22\",\"ReleaseId\": \"Releases-22\",\"EnvironmentId\": \"Environments-2\",\"ForcePackageDownload\": false,\"ForcePackageRedeployment\": false,\"SkipActions\": [],\"SpecificMachineIds\": [],\"DeploymentProcessId\": \"deploymentprocess-Projects-1-s-4-NH2MN\",\"ManifestVariableSetId\": \"variableset-Deployments-22\",\"TaskId\": \"ServerTasks-43\",\"ProjectId\": \"Projects-1\",\"UseGuidedFailure\": true,\"Comments\": null,\"FormValues\": {},\"QueueTime\": null,\"Name\": \"Deploy to local\",\"Created\": \"2015-11-12T09:58:33.113+00:00\",\"Links\": {\"Self\": \"/api/deployments/Deployments-22\",\"Release\": \"/api/releases/Releases-22\",\"Environment\": \"/api/environments/Environments-1\",\"Project\": \"/api/projects/Projects-1\",\"Task\": \"/api/tasks/ServerTasks-43\",\"Web\": \"/app#/deployments/Deployments-22\",\"Artifacts\": \"/api/artifacts?regarding=Deployments-22\",\"Variables\": \"/api/variables/variableset-Deployments-22\",\"Interruptions\": \"/api/interruptions?regarding=Deployments-22\"}},{\"Id\": \"Deployments-4\",\"ReleaseId\": \"Releases-1\",\"EnvironmentId\": \"Environments-1\",\"ForcePackageDownload\": false,\"ForcePackageRedeployment\": false,\"SkipActions\": [],\"SpecificMachineIds\": [],\"DeploymentProcessId\": \"deploymentprocess-Projects-1-s-3-ULBZF\",\"ManifestVariableSetId\": \"variableset-Deployments-4\",\"TaskId\": \"ServerTasks-21\",\"ProjectId\": \"Projects-1\",\"UseGuidedFailure\": true,\"Comments\": null,\"FormValues\": {},\"QueueTime\": null,\"Name\": \"Deploy to local (#4)\",\"Created\": \"2015-11-12T09:22:00.865+00:00\",\"Links\": {\"Self\": \"/api/deployments/Deployments-4\",\"Release\": \"/api/releases/Releases-1\",\"Environment\": \"/api/environments/Environments-1\",\"Project\": \"/api/projects/Projects-1\",\"Task\": \"/api/tasks/ServerTasks-21\",\"Web\": \"/app#/deployments/Deployments-4\",\"Artifacts\": \"/api/artifacts?regarding=Deployments-4\",\"Variables\": \"/api/variables/variableset-Deployments-4\",\"Interruptions\": \"/api/interruptions?regarding=Deployments-4\"}},{\"Id\": \"Deployments-3\",\"ReleaseId\": \"Releases-1\",\"EnvironmentId\": \"Environments-1\",\"ForcePackageDownload\": false,\"ForcePackageRedeployment\": false,\"SkipActions\": [],\"SpecificMachineIds\": [],\"DeploymentProcessId\": \"deploymentprocess-Projects-1-s-3-ULBZF\",\"ManifestVariableSetId\": \"variableset-Deployments-3\",\"TaskId\": \"ServerTasks-20\",\"ProjectId\": \"Projects-1\",\"UseGuidedFailure\": false,\"Comments\": null,\"FormValues\": {},\"QueueTime\": null,\"Name\": \"Deploy to local (#3)\",\"Created\": \"2015-11-12T09:19:40.542+00:00\",\"Links\": {\"Self\": \"/api/deployments/Deployments-3\",\"Release\": \"/api/releases/Releases-1\",\"Environment\": \"/api/environments/Environments-1\",\"Project\": \"/api/projects/Projects-1\",\"Task\": \"/api/tasks/ServerTasks-20\",\"Web\": \"/app#/deployments/Deployments-3\",\"Artifacts\": \"/api/artifacts?regarding=Deployments-3\",\"Variables\": \"/api/variables/variableset-Deployments-3\",\"Interruptions\": \"/api/interruptions?regarding=Deployments-3\"}},{\"Id\": \"Deployments-2\",\"ReleaseId\": \"Releases-1\",\"EnvironmentId\": \"Environments-1\",\"ForcePackageDownload\": false,\"ForcePackageRedeployment\": false,\"SkipActions\": [],\"SpecificMachineIds\": [],\"DeploymentProcessId\": \"deploymentprocess-Projects-1-s-3-ULBZF\",\"ManifestVariableSetId\": \"variableset-Deployments-2\",\"TaskId\": \"ServerTasks-19\",\"ProjectId\": \"Projects-1\",\"UseGuidedFailure\": false,\"Comments\": null,\"FormValues\": {},\"QueueTime\": null,\"Name\": \"Deploy to local (#2)\",\"Created\": \"2015-11-12T09:07:24.473+00:00\",\"Links\": {\"Self\": \"/api/deployments/Deployments-2\",\"Release\": \"/api/releases/Releases-1\",\"Environment\": \"/api/environments/Environments-1\",\"Project\": \"/api/projects/Projects-1\",\"Task\": \"/api/tasks/ServerTasks-19\",\"Web\": \"/app#/deployments/Deployments-2\",\"Artifacts\": \"/api/artifacts?regarding=Deployments-2\",\"Variables\": \"/api/variables/variableset-Deployments-2\",\"Interruptions\": \"/api/interruptions?regarding=Deployments-2\"}},{\"Id\": \"Deployments-1\",\"ReleaseId\": \"Releases-1\",\"EnvironmentId\": \"Environments-1\",\"ForcePackageDownload\": false,\"ForcePackageRedeployment\": false,\"SkipActions\": [],\"SpecificMachineIds\": [],\"DeploymentProcessId\": \"deploymentprocess-Projects-1-s-3-ULBZF\",\"ManifestVariableSetId\": \"variableset-Deployments-1\",\"TaskId\": \"ServerTasks-17\",\"ProjectId\": \"Projects-1\",\"UseGuidedFailure\": false,\"Comments\": null,\"FormValues\": {},\"QueueTime\": null,\"Name\": \"Deploy to local\",\"Created\": \"2015-11-12T08:30:24.194+00:00\",\"Links\": {\"Self\": \"/api/deployments/Deployments-1\",\"Release\": \"/api/releases/Releases-1\",\"Environment\": \"/api/environments/Environments-1\",\"Project\": \"/api/projects/Projects-1\",\"Task\": \"/api/tasks/ServerTasks-17\",\"Web\": \"/app#/deployments/Deployments-1\",\"Artifacts\": \"/api/artifacts?regarding=Deployments-1\",\"Variables\": \"/api/variables/variableset-Deployments-1\",\"Interruptions\": \"/api/interruptions?regarding=Deployments-1\"}}],\"Links\": {\"Self\": \"/api/deployments?projects=Projects-1\",\"Template\": \"/api/deployments{?skip,take,projects,environments,taskState}\",\"Page.Current\": \"/api/deployments?skip=0&projects=Projects-1\",\"Page.0\": \"/api/deployments?skip=0&projects=Projects-1\"}}";
      }
      //server task for deployments-41, environment-1, failed
      if (s.equals(octopusUrl + "/api/tasks/ServerTasks-76")) {
        return "{\"Id\": \"ServerTasks-76\",\"Name\": \"Deploy\",\"Description\": \"Deploy TestProject release 0.0.5 to local\",\"Arguments\": {\"DeploymentId\": \"Deployments-41\"},\"State\": \"Failed\",\"Completed\": \"09 December 2015 17:31\",\"QueueTime\": \"2015-12-08T08:09:39.546+00:00\",\"StartTime\": \"2015-12-08T08:09:40.046+00:00\",\"LastUpdatedTime\": \"2015-12-09T17:31:36.402+00:00\",\"CompletedTime\": \"2015-12-09T17:31:36.402+00:00\",\"ServerNode\": \"DESKTOP-4VQNCHP\",\"Duration\": \"1 day\",\"ErrorMessage\": \"The deployment failed because one or more steps failed. Please see the deployment log for details.\",\"HasBeenPickedUpByProcessor\": true,\"IsCompleted\": true,\"FinishedSuccessfully\": false,\"HasPendingInterruptions\": true,\"CanRerun\": false,\"HasWarningsOrErrors\": true,\"Links\": {\"Self\": \"/api/tasks/ServerTasks-76\",\"Web\": \"/app#/tasks/ServerTasks-76\",\"Raw\": \"/api/tasks/ServerTasks-76/raw\",\"Rerun\": \"/api/tasks/rerun/ServerTasks-76\",\"Cancel\": \"/api/tasks/ServerTasks-76/cancel\",\"QueuedBehind\": \"/api/tasks/ServerTasks-76/queued-behind\",\"Details\": \"/api/tasks/ServerTasks-76/details{?verbose,tail}\",\"Artifacts\": \"/api/artifacts?regarding=ServerTasks-76\",\"Interruptions\": \"/api/tasks\"}}";
      }
      //server task for deployments-22, environment-2, success
      if (s.equals(octopusUrl + "/api/tasks/ServerTasks-43")) {
        return "{\"Id\": \"ServerTasks-43\",\"Name\": \"Deploy\",\"Description\": \"Deploy TestProject release 0.0.5 to test\",\"Arguments\": {\"DeploymentId\": \"Deployments-22\"},\"State\": \"Success\",\"Completed\": \"12 November 2015 09:59\",\"QueueTime\": \"2015-11-12T09:58:33.099+00:00\",\"StartTime\": \"2015-11-12T09:58:33.899+00:00\",\"LastUpdatedTime\": \"2015-11-12T09:59:07.071+00:00\",\"CompletedTime\": \"2015-11-12T09:59:07.071+00:00\",\"ServerNode\": \"DESKTOP-4VQNCHP\",\"Duration\": \"33 seconds\",\"ErrorMessage\": \"\",\"HasBeenPickedUpByProcessor\": true,\"IsCompleted\": true,\"FinishedSuccessfully\": true,\"HasPendingInterruptions\": true,\"CanRerun\": false,\"HasWarningsOrErrors\": true,\"Links\": {\"Self\": \"/api/tasks/ServerTasks-43\",\"Web\": \"/app#/tasks/ServerTasks-43\",\"Raw\": \"/api/tasks/ServerTasks-43/raw\",\"Rerun\": \"/api/tasks/rerun/ServerTasks-43\",\"Cancel\": \"/api/tasks/ServerTasks-43/cancel\",\"QueuedBehind\": \"/api/tasks/ServerTasks-43/queued-behind\",\"Details\": \"/api/tasks/ServerTasks-43/details{?verbose,tail}\",\"Artifacts\": \"/api/artifacts?regarding=ServerTasks-43\",\"Interruptions\": \"/api/tasks\"}}";
      }
      //servr task for deployments-4, environment-1, success
      if (s.equals(octopusUrl + "/api/tasks/ServerTasks-21")) {
        return "{\"Id\": \"ServerTasks-21\",\"Name\": \"Deploy\",\"Description\": \"Deploy TestProject release 0.0.1 to local\",\"Arguments\": {\"DeploymentId\": \"Deployments-4\"},\"State\": \"Success\",\"Completed\": \"12 November 2015 09:22\",\"QueueTime\": \"2015-11-12T09:22:00.558+00:00\",\"StartTime\": \"2015-11-12T09:22:03.731+00:00\",\"LastUpdatedTime\": \"2015-11-12T09:22:45.599+00:00\",\"CompletedTime\": \"2015-11-12T09:22:45.599+00:00\",\"ServerNode\": \"DESKTOP-4VQNCHP\",\"Duration\": \"42 seconds\",\"ErrorMessage\": \"\",\"HasBeenPickedUpByProcessor\": true,\"IsCompleted\": true,\"FinishedSuccessfully\": true,\"HasPendingInterruptions\": false,\"CanRerun\": false,\"HasWarningsOrErrors\": false,\"Links\": {\"Self\": \"/api/tasks/ServerTasks-21\",\"Web\": \"/app#/tasks/ServerTasks-21\",\"Raw\": \"/api/tasks/ServerTasks-21/raw\",\"Rerun\": \"/api/tasks/rerun/ServerTasks-21\",\"Cancel\": \"/api/tasks/ServerTasks-21/cancel\",\"QueuedBehind\": \"/api/tasks/ServerTasks-21/queued-behind\",\"Details\": \"/api/tasks/ServerTasks-21/details{?verbose,tail}\",\"Artifacts\": \"/api/artifacts?regarding=ServerTasks-21\",\"Interruptions\": \"/api/tasks\"}}";
      }
      return null;
    }

    public void init(URI uri, String octopusApiKey, Integer connectionTimeout) throws KeyStoreException, NoSuchAlgorithmException, KeyManagementException {
      //no-op
    }
  }
}
